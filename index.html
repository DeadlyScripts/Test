<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Paste â†’ Pastefy.app with Thumbnail</title>
    <meta name="description" content="Paste code + upload thumbnail image â†’ pastefy.app"/>
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0f0f1a;
            color: #e0e0ff;
            min-height: 100vh;
            padding: 2rem;
            background-image: 
                radial-gradient(circle at 25% 15%, rgba(100,100,255,0.08) 0%, transparent 25%),
                radial-gradient(circle at 75% 85%, rgba(180,100,255,0.06) 0%, transparent 35%);
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 {
            font-size: 2.6rem;
            text-align: center;
            margin-bottom: 0.4rem;
            background: linear-gradient(90deg, #a78bfa, #7dd3fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle { color: #94a3b8; text-align: center; margin-bottom: 2rem; font-size: 1.1rem; }
        
        .editor-wrapper {
            border-radius: 12px;
            overflow: hidden;
            background: #1e1e38;
            border: 1px solid #334155;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6);
        }
        #codeInput {
            width: 100%;
            min-height: 320px;
            padding: 1.5rem;
            background: #111827;
            color: #e0e0ff;
            font-family: 'Consolas', monospace;
            font-size: 15px;
            line-height: 1.45;
            border: none;
            resize: vertical;
            outline: none;
        }
        
        .upload-area {
            padding: 1.2rem 1.5rem;
            background: #172033;
            border-top: 1px solid #2d3748;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }
        .upload-area label {
            background: #334155;
            color: #e0e0ff;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .upload-area label:hover { background: #475569; }
        #thumbnailPreview {
            max-height: 120px;
            max-width: 180px;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid #64748b;
            display: none;
        }
        #fileName { color: #94a3b8; font-size: 0.95rem; flex: 1; }
        
        .controls {
            padding: 1rem 1.5rem;
            background: #172033;
            border-top: 1px solid #2d3748;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        button {
            background: linear-gradient(90deg, #7c3aed, #3b82f6);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(124,58,237,0.45);
        }
        #status { color: #94a3b8; font-size: 0.95rem; flex: 1; }
        .success { color: #34d399 !important; }
        .error { color: #f87171 !important; }
        
        footer {
            margin-top: 3rem;
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
        }
        a { color: #a78bfa; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h1>Pastefy Quick + Thumbnail</h1>
    <p class="subtitle">Upload image â†’ paste code â†’ get nice preview on pastefy.app</p>

    <div class="editor-wrapper">
        <textarea 
            id="codeInput" 
            placeholder="Paste or write your code here...&#10;&#10;(Image will appear as big preview/thumbnail)"
            spellcheck="false"
            autofocus
        ></textarea>

        <div class="upload-area">
            <label for="thumbnailInput">ðŸ“¸ Choose Thumbnail Image</label>
            <input type="file" id="thumbnailInput" accept="image/*" hidden>
            <img id="thumbnailPreview" alt="Thumbnail preview"/>
            <span id="fileName">No image selected</span>
        </div>

        <div class="controls">
            <button id="createBtn">Create Paste with Thumbnail â†’</button>
            <span id="status">Ready...</span>
        </div>
    </div>

    <footer>
        Image becomes big preview Â· Works great with markdown code Â· 
        <a href="https://pastefy.app" target="_blank">pastefy.app</a>
    </footer>
</div>

<script>
const textarea = document.getElementById('codeInput');
const fileInput = document.getElementById('thumbnailInput');
const preview = document.getElementById('thumbnailPreview');
const fileNameEl = document.getElementById('fileName');
const btn = document.getElementById('createBtn');
const status = document.getElementById('status');

let selectedImageBase64 = null;
let selectedFileName = null;

fileInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) {
        fileNameEl.textContent = "Please select an image file";
        return;
    }

    selectedFileName = file.name;
    fileNameEl.textContent = file.name;

    // Convert to base64
    try {
        const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
        
        selectedImageBase64 = base64;
        preview.src = base64;
        preview.style.display = 'block';
    } catch (err) {
        console.error(err);
        fileNameEl.textContent = "Error loading image";
    }
});

async function createPaste() {
    const code = textarea.value.trim();
    let content = code;

    // If we have image â†’ put it as big markdown image at top
    if (selectedImageBase64) {
        const ext = selectedFileName ? selectedFileName.split('.').pop().toLowerCase() : 'png';
        const mdImage = `![${selectedFileName || 'Thumbnail'}](${selectedImageBase64})\n\n`;
        content = mdImage + (code ? `**Code / Content:**\n\n\`\`\`\n${code}\n\`\`\`` : '');
    } else if (!code) {
        status.textContent = "Nothing to paste...";
        status.className = "";
        return;
    }

    status.textContent = "Creating...";
    status.className = "";

    try {
        const response = await fetch('https://pastefy.app/api/v2/pastes', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                content: content,
                title: selectedFileName ? `${selectedFileName} - Code/Content` : "Code + Image",
                public: true,
                expire_at: null
            })
        });

        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const data = await response.json();
        
        if (!data.success || !data.paste?.url) {
            throw new Error("No URL returned");
        }

        const url = data.paste.url;
        
        status.innerHTML = `Done! â†’ <a href="${url}" target="_blank">${url}</a>`;
        status.className = "success";

        try { navigator.clipboard.writeText(url); } catch {}
        
    } catch (err) {
        console.error(err);
        status.textContent = "Error... try again";
        status.className = "error";
    }
}

// Ctrl+Enter to submit
textarea.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        createPaste();
    }
});

btn.addEventListener('click', createPaste);
</script>
</body>
</html>
